---
title: "Coursework II - Videogame Sales Data Analysis"
output:
  html_document:
    df_print: paged
    toc: true 
    toc_depth: 2
    number_sections: true
---

```{r setup, include = FALSE}
library(tidyverse)
library(lubridate)
library(here)
library(janitor)
library(ggrepel)
```


# Introduction

This dataset from [kaggle](https://www.kaggle.com/gregorut/videogamesales) contains
a list of video games with sales greater than 100,000 copies, generated by a 
webscrape of [VGChartz](http://www.vgchartz.com/) using a script based on the 
Beautiful Soup library in Python, developed by the same user who shared the data.
The purpose for which the data was collected was not explicitly stated; however, 
since it is available on Kaggle, it was probably meant to be used to practice
ML or data analysis skills, or to prove competence in web scraping. 

It is a topic worth studying to understand which videogame genres are the most 
popular (and how this changed with time), the difference in the number of sales 
and consumer taste in four regions (Europe, North America, Japan and ROW), and what
are the titles with the highest number of copies sold. 

# Data

```{r, echo = FALSE, warning = FALSE, message = FALSE}
vgsales_raw <- read_csv(file = here("data", "archive_vgsales.zip"))
vgsales_clean <- as.tibble(vgsales_raw) %>%
  clean_names() %>%
  mutate(across(c(platform, genre), as.factor)) %>%
  mutate(year = as.integer(year)) %>%
  select(!global_sales) %>%
  pivot_longer(
    cols = na_sales:other_sales,
    names_sep = "_",
    names_to = c("region", ".value")
  ) %>%
  mutate(region = str_to_upper(region)) %>%
  mutate(region = as.factor(region))
#the Global sales column was deleted, as it is possible to recreate it for
#further analysis with the following code: 

#vgsales_raw %>% group_by(rank) %>%
#summarise(global_sales = sum(sales,na.rm = TRUE)) %>%
#arrange(desc(global_sales))
```

The original dataset contained 16,598 rows (observations), each corresponding to a game.
The data was not organised in a tidy format: the number of copies sold for each
title were divided into 4 columns (one for each of the regions), and there was
a fifth column called `Global_Sales` which contained the total sales for the game. 

Since tidyverse packages operate on the assumption that the data is organised in
a tidy manner, the tibble was pivoted longer so that the sales figures were 
included in a `sales` column, and the regions in a `region` column. 
This generated 4 rows per game, and a total of 66,392 rows. The `Global Sales`
column was deleted, as it can be recreated with code. Other modifications included
the coercion of appropriate data types to the columns.

The variables contained in the clean dataset were:

* `rank`: ranking based on global sales, in the original raw dataset;
* `name`: the game title;
* `platform`: the console that the game is compatible with; 
* `year`: year of release;
* `genre`: category of the game;
* `publisher`: the game development company;
* `region`: world region as in North America, Europe, Japan and ROW (OTHER);
* `sales`: number of copies sold

Some observations were filtered out in certain plots. When this is the case, 
a comment has been added in the code and in the analysis of the plot. 

# Questions

The following questions were raised, and corresponding visualisations generated
in an attempt of answering them:

1. How did videogame sales change with time, by region?
2. How many games sold more than 100,000 copies per year, each year?
3. What genres were the most popular, and was there a difference 
in genre popularity by region?
4. Which platforms have had the biggest sales? 
5. How was the number of copies sold distributed among the different genres? 

These questions, their operationalisations and their answers are explored in
their relevant sections below.

# Analysis

## How did videogame sales change with years, by region?

**Operationalisation**: by calculating the sum of sales by region and year, 
it is possible to draw an area chart and a line chart that shows the cumulative
numbers of copies sold for every year, colour-coded by region.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
vgsales_clean %>% 
  group_by(year, region) %>%
  summarise(sum_sales = sum(sales, na.rm = TRUE)) %>%
ggplot() +
  geom_area(mapping = aes(x = year, y = sum_sales, fill = region),
            colour = "black",
            alpha = 0.5) -> p1_a

vgsales_clean %>%
  group_by(year, region) %>%
  summarise(sum_sales = sum(sales, na.rm = TRUE)) %>%
ggplot() +
  geom_line(mapping = aes(x = year, y = sum_sales, colour = region)) -> p1_b

p1_a +
  labs(
    x = "Year",
    y = "Copies sold, in m",
    fill = "Region",
    title = "Area chart of copies sold vs year, by region"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5)
  )
p1_b +
  labs(
    x = "Year",
    y = "Copies sold, in m",
    colour = "Region",
    title = "Line chart of copies sold vs year, by region"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5)
  )
```

The two charts display the same information, albeit with a slight difference: the area
chart stacks the data and it is better used to show the cumulative number of copies sold, 
whereas the line chart highlights the relative amounts and is the better choice
for comparison across regions. For this reason, the y-scales are different. 

Interestingly, when it comes to region comparison, sales were roughly flat for
Japan between 1995 and later years, suggesting market saturation. On the contrary, 
other regions in the world took over Japan in 2008, although they remained well
behind Europe and North America. 

As can be seen in the area chart, the number of copies sold exceeded 100m
shortly after 1995, reached a peak of over 650m in 2008, and declined thereafter.
However, it is worth noting that this dataset was compiled in 2016 and
only 3 games reported afterwards.

Therefore, it is also worth checking how many entries were reported by year, 
which will be explored in the next question.

## How many games sold more than 100,000 copies per year, each year?

**Operationalisation**: by counting the number of titles that sold more than 
100,000 copies each year and plotting a column chart of year vs count. The count
had to be divided by 4, as there are four rows per game (one for each region).

```{r, echo = FALSE, warning = FALSE}
p2 <- vgsales_clean %>%
  group_by(year) %>%
  count() %>%
  ggplot() +
  geom_col(mapping = aes(x = year, y = n / 4)) + #since pivot_longer created 
  #4 rows per title, counts had to be divided by 4
  scale_x_continuous(breaks = seq(from = 1980, to = 2020, by = 5)) +
  scale_y_continuous(breaks = seq(from = 0, to = 1500, by = 250),
                     expand = expansion(c(0, 0.1)))

p2 +
  labs(
    x = "Year",
    y = "Number of games that sold >100k copies",
    title = "Number of dataset entries vs year"
  ) + theme(
    plot.title = element_text(hjust = 0.5),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank()
    ) +
  annotate(
    geom = "rect",
    xmin  = 1994.5,
    xmax  = 1999.5,
    ymin  = 0,
    ymax  = 450,
    alpha = 0.4,
    fill  = "pink"
  ) +
  annotate(
    geom = "rect",
    xmin  = 1999.5,
    xmax  = 2005.5,
    ymin  = 0,
    ymax  = 950,
    alpha = 0.4,
    fill  = "lightblue"
  ) +
  annotate(
    geom = "rect",
    xmin  = 2005.5,
    xmax  = 2012.5,
    ymin  = 0,
    ymax  = 1450,
    alpha = 0.4,
    fill  = "green"
  ) +
  annotate(
    geom = "text",
    fontface = "bold",
    x    = 1995,
    y    = 500,
    label = "5th gen consoles",
    hjust = 0.5, vjust = 0,
    colour = "pink"
  ) +
  annotate(
    geom = "text",
    fontface = "bold",
    x    = 2000,
    y    = 1000,
    label = "6th gen consoles",
    hjust = 0.4, vjust = 0,
    colour = "lightblue"
  ) +
  annotate(
    geom = "text",
    x    = 2006,
    y    = 1500,
    label = "7th gen consoles",
    hjust = 0.1, vjust = 0,
    colour = "green"
  )
  
```

It can be observed that there was a marked increase in the popularity of videogames
starting in 1995, when the 5th generation of consoles (see 
[Wikipedia](https://en.wikipedia.org/wiki/Home_video_game_console)
for more info) was released. The introduction of the 6th generation of consoles
led to another marked increase in the number of games that sold more than 
100,000 copies, whereas the advent of 7th generation consoles led to a 
general rise until 2009, to decline in the subsequent years. 
The cause of this decline is hard to glean from the dataset; in particular, 
to make informed guesses, one would need to know if this dataset tracks digital 
download or content aggregators such as Steam, to ensure that the picture shown
here is correct. 

## What genres were the most popular, and was there a difference in genre popularity by region?

**Operationalisation**: filtering out 2020 because it has only a single title, 
it is possible to display a normalised bar chart of the market share of
different genres over the years. This can be further refined by showing the 
regions in their own facet. A cumulative sales bar chart was added as well. 

```{r, echo = FALSE, message = FALSE,warning = FALSE}
p3_a <- vgsales_clean %>% 
  filter(year != 2020) %>% #only one title for 2020
  group_by(year, genre, region) %>%
  summarise(region = region,
            genre = genre,
            sum_sales = sum(sales, na.rm = TRUE)) %>%
  distinct(.keep_all = FALSE) %>%
  ggplot() +
  geom_col(mapping = aes(x = year, y = sum_sales, fill = genre),
           colour = "black",
           position = "fill") +
  facet_wrap(facets = vars(region))

p3_a + labs(
  x = "Year",
  y = "Proportion of sales",
  title = "Popularity of genres over the years, by region",
  fill = "Genre"
) + theme(
  plot.title = element_text(hjust = 0.5)
)
```

```{r, echo = FALSE, message = FALSE}
p3_b <- vgsales_clean %>%
  filter(year != 2020) %>%
  group_by(genre, region) %>% 
  summarise(sum_sales = sum(sales, na.rm = FALSE)) %>%
  ggplot() +
  geom_col(mapping = aes(y = genre, x = sum_sales, fill = genre)) +
  facet_wrap(facets = vars(region))

p3_b + labs(
  x = "Cumulative sales across the years 1980-2017",
  y = "Genre",
  fill = "Genre",
  title = "Overall popularity of genres by region"
) +
  theme(
    plot.title = element_text(hjust = 0.5)
  )
```

While the first plot might be somewhat hard to read, it can be seen that shooters
were very popular in the years 1980-1985, but lost share to platform games in 
1985-1995 across NA, EU and ROW. However, shooters experienced an upsurge in popularity 
starting in 2010. Sports games became slightly more popular in NA, EU and ROW 
over time, whereas their share decreased in the Japanese market.

In the second plot, the cumulative sales of different genres over the years are
reported. It can be seen that the relative height of the bars is very similar
for EU, NA and ROW, with action games, sports and shooter games ranking 1st, 2nd
and 3rd in popularity. 
The Japanese market is markedly different: the most popular genre was role-playing,
followed by action games and sports/platform at joint 3rd place. In particular, 
shooters had the lowest cumulative sales, as opposed to the remaining regions. 

This is very useful insight, should a game developer decide which type of game
to create and which markets to target. 

## Which platforms have had the biggest sales?

**Operationalisation**: a simple column chart of cumulative sales by platform
can show which platforms were associated with the most sold games. A factor 
collapse (Platform type/gen) can also allow comparison between consoles that
belong to the same generation. All generations were defined as per the 
[Home Video Game Console](https://en.wikipedia.org/wiki/Home_video_game_console)
page on Wikipedia.

```{r, echo = FALSE, message = FALSE}
p4 <- vgsales_clean %>%
  group_by(platform) %>%
  summarise(sum_sales = sum(sales, na.rm = TRUE)) %>%
  mutate(platform = fct_reorder(platform, sum_sales)) %>% 
  mutate(platform_gen = fct_collapse(platform, 
                                   Retro = c("2600", "3DO", "GEN", "GG", "NES",
                                             "NG", "PCFX", "SAT", "SCD", "SNES",
                                             "TG16"),
                                   Gen5 = c("N64","SAT","PS"),
                                   Gen6 = c("GC","DC","PS2","XB"),
                                   Gen7 = c("Wii","PS3","X360"),
                                   Gen8 = c("PS4","XOne","WiiU"),
                                   Handheld = c("3DS", "PSV", "DS", "PSP",
                                                "GBA", "GB", "WS"),
                                   PC = c("PC"))) %>%
  mutate(platform_gen = fct_relevel(platform_gen, 
                                    c("Retro","Handheld","PC","Gen5","Gen6","Gen7","Gen8"))) %>% 
  ggplot() +
  geom_col(mapping = aes(x = sum_sales, y = platform, fill= platform_gen)) +
  scale_x_continuous(expand = expansion(mult = c(0,0.05)))

p4 + labs(
  x = "Cumulative sales across the years 1980-2020, in m",
  y = "Platform",
  title = "Cumulative sales by platform",
  fill = "Platform type/gen"
) + theme(
  plot.title = element_text(hjust = 0.5),
  axis.ticks.y = element_blank(),
  panel.grid.minor.x = element_blank(),
  panel.grid.major.y = element_blank()
)
```


This column chart shows that most games sold were for the PS2, followed by all
the Gen7 consoles. Gen8 consoles are behind in the ranking, but it is worth
bearing in mind that the dataset includes games up to 2016, so the data for Gen8
is incomplete.
Among handheld consoles, the Nintendo DS was on top of the chart, whereas PC games 
totalled slightly more than 250m sales, way below any other console since Gen6. 
However, this is probably not an index of popularity of PC games or of the platform itself, 
since there is a wider choice of games (including those from indie developers) 
and it is easier to pirate them. 
The Super Nintendo Entertainment System (SNES) had the highest game sales among
the retro (pre-Gen5) consoles.

## How was the number of copies sold distributed among the different regions, and which titles were the most popular? Which game developers have sold the most copies?

**Operationalisation**: after removing all titles with less than 1m copies, a
boxplot of sales vs region was generated. Titles with 10m sales or more are 
labelled. A table containing the top-ten game developers is included as well. 

```{r, echo = FALSE, fig.width = 10}
p5 <- vgsales_clean %>% filter(sales >= 1) %>% #to remove titles below 1,000,000 copies
  ggplot() +
  geom_boxplot(mapping = aes(x = region, y = sales)) +
  geom_text_repel(data = vgsales_clean %>% filter(sales >= 10),
                  mapping = aes(x = region, y = sales, label = name),
                  size = 3,
                  nudge_x = 0.1,
                  direction = "y",
                  hjust = 0,
                  ylim = c(12,40),
                  segment.alpha = 0.3)+
  geom_hline(yintercept = 2.5,
             linetype = "dashed",
             colour = "red"
             )

p5 + labs(
  x = "Region",
  y = "Number of sales",
  title = "Boxplots of sales vs region",
  subtitle = "Titles that sold more than 10m copies are labelled"
) + annotate(
  geom ="text",
  label ="2.5m ",
  x = 0.55,
  y = 4,
  colour = "red",
  size = 4
) + theme(
  plot.title = element_text(hjust = 0.5),
  plot.subtitle = element_text(size = 10),
  panel.grid.minor.y = element_blank(),
  panel.grid.major.x = element_blank()
)
```

The boxplots were drawn using a filtered version of the dataset, which contains
only those titles that sold more than 1m copies, to avoid flattening the
boxplot too much by counting the many titles that sold less.  

It can be seen that the vast majority of those titles (75% of them based on the 
interquartile range) sold less than 2.5m copies.
In particular, only 4 titles in Europe, 1 in Japan and 1 in the rest of the 
world sold more than 10m copies, whereas 13 titles in North America made it 
past that threshold. 
With the exception of Grand Theft Auto: San Andreas, Duck Hunt and Tetris, 
all games that sold more than 10 million copies were Nintendo exclusives.

As for the top ten game developers, they are:

```{r, echo = FALSE, message = FALSE, results = "markup"}
vgsales_clean %>% group_by(publisher) %>%
  summarise(`Total sales` = sum(sales, na.rm = TRUE)) %>%
  arrange(desc(`Total sales`)) %>% 
  rename(`Publisher` = publisher) %>% 
  slice_head(n = 10)
```

# Conclusions

The results of this analysis have highlighted that video game sales soared since 1995, 
reached a peak in 2009 and declined afterwards. 
The most popular genres changed over time, but as of 2017 they were action games, 
sports and shooters, with the exception of Japan where role-playing games (RPG)
were more popular.
The game that sold the most in both the NA and EU market was Wii Sports, and the most popular console (in terms of game units sold) was the PS2 among home consoles, and the Nintendo DS among handheld devices. 
The most successful game developer was Nintendo, followed by EA (Electronic Arts) and Activision. 

Interestingly, analysis of this dataset has highlighted a decline in videogame sales since 2009. 
It would be interesting to understand if this conclusion is reliable, or if there 
are some aspects of modern game purchasing (ie. digital downloads, microtransactions etc.)
that are not captured in the dataset. 
Another interesting question is what the trend was for the years 2017-2020, due 
to lack of data. 



